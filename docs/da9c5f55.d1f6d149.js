(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{111:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(7),o=(n(0),n(119)),i={id:"authorisation",title:"Authorisation",sidebar_label:"Authorisation",slug:"/authorisation"},s={unversionedId:"authorisation",id:"authorisation",isDocsHomePage:!1,title:"Authorisation",description:"Authorisation\xa0is the process of specifying access/ rights/ privileges to various resources. It provides information security and computer security to systems. Of course, we can control the access to users as well. The authorisation process decides whether access should be given or denied.",source:"@site/content/authorisation.md",slug:"/authorisation",permalink:"/docs/authorisation",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/authorisation.md",version:"current",sidebar_label:"Authorisation",sidebar:"docs",previous:{title:"CRUD APIs",permalink:"/docs/crud"},next:{title:"Maths APIs",permalink:"/docs/maths-api"}},c=[],l={toc:c};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Authorization"},"Authorisation"),"\xa0is the process of specifying access/ rights/ privileges to various resources. It provides information security and computer security to systems. Of course, we can control the access to users as well. The authorisation process decides whether access should be given or denied."),Object(o.b)("p",null,"Authorization defers from ",Object(o.b)("a",{parentName:"p",href:"#"},"Authentication"),". Authentication verifies the identity of a user. In authorisation, a user or an application gets permission to access a resource. The resource determines the extent of the permissions it should grant."),Object(o.b)("p",null,"Classic authorisation models consist of a triple; a ",Object(o.b)("a",{parentName:"p",href:"#subject"},"subject"),", an ",Object(o.b)("a",{parentName:"p",href:"#object"},"object"),", and an ",Object(o.b)("inlineCode",{parentName:"p"},"action"),". Hypi adopts this triple with few enhancements."),Object(o.b)("p",null,"Hypi's authorisation model is similar to ",Object(o.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/User-Managed_Access"},"User\xa0Managed Access Control"),"\xa0/UMA. But it is not a compliant implementation of the same."),Object(o.b)("p",null,"Check out the concepts involved in the authorisation."),Object(o.b)("h4",{id:"subject"},"Subject"),Object(o.b)("p",null,"A subject is an entity trying to perform an action or gain access to a resource."),Object(o.b)("h4",{id:"object"},"Object"),Object(o.b)("p",null,"An object or a resource is the thing being protected. In Hypi, two primary things can be protected."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Resource\xa0- any object that exists on the Hypi platform"),Object(o.b)("li",{parentName:"ul"},"Scope\xa0- Any GraphQL field of any type OR any arbitrary Uniform Resource Identifier")),Object(o.b)("h4",{id:"policy"},"Policy"),Object(o.b)("p",null,"A policy is an interface with two fields that contain important pieces of information. It has the name of the\xa0",Object(o.b)("inlineCode",{parentName:"p"},"subject")," to provide authorisation. And it holds the logic of granting or denying access. The values of the logic can be Positive or Negative."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"interface\xa0Policy\xa0{\nhypi:\xa0Hypi\nname:\xa0String!\nlogic:\xa0AuthLogic\n}\n")),Object(o.b)("p",null,"There are several parameters to decide the policy of authorisation. One of the main purposes of a policy is to promote re-use. Policies are intended to be created and re-used so that they can be kept as simple as possible."),Object(o.b)("p",null,"Hypi has various policy types for different kinds of subjects. Various groups, accounts, roles, realms, clients have individual policy objects. A time-bound access policy is also in place. You can also group various policies with Aggregate policy. "),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"GroupPolicy\xa0- Applies to a list of Accounts or Organisations in the groups.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type GroupPolicy implements Policy {\nname:String!\nlogic:AuthLogic\ngroups(...):\\[Group!\\]\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"RolePolicy\xa0- Applies to a list of Roles.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type RolePolicy implements Policy {\nname:String!\nlogic:AuthLogic\nroles(...):\\[Role!\\]!\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"AccountPolicy\xa0- Applies to a set of Accounts.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type AccountPolicy implements Policy {\nname:String!\nlogic:AuthLogic\naccounts(...):\\[Account!\\]\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"RealmPolicy\xa0- Applies to a set of Realms.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type RealmPolicy implements Policy {\nname:String!\nlogic:AuthLogic\nrealms(...):\\[RealmLink!\\]\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"TimePolicy\xa0\u2013 Allows time-bound access to groups, roles, accounts, realms, and clients.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type TimePolicy implements Policy {\nfrom:DateTime\nto:DateTime\nname:String!\nlogic:AuthLogic\nclients(...):\\[AuthClient!\\]\nroles(...):\\[Role!\\]\ngroups(...):\\[Group!\\]\naccounts(...):\\[Account!\\]\nrealms(...):\\[RealmLink!\\]\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"ClientPolicy\xa0- Controls access based on the client used to access a resource. A client acts on behalf of a subject.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type ClientPolicy implements Policy {\nname:String!\nlogic:AuthLogic\nclients(...):\\[AuthClient!\\]\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"AggregatePolicy\xa0- Allows grouping one or more policies.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type Aggregated Policy implementsPolicy {\ndecisionStrategy:DecisionStrategy\nname:String!\nlogic:AuthLogic\npolicies(...):\\[Policy!\\]!\n}\n")),Object(o.b)("h4",{id:"permission"},"Permission"),Object(o.b)("p",null,"Permission encapsulates the object involved in the authorisation. You may check out the parameters in the ",Object(o.b)("a",{parentName:"p",href:"#example"},"example")," section."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"typePermission\xa0{\nhypi:\xa0Hypi\nname:\xa0String!\ndecisionStrategy:\xa0DecisionStrategy\ntype:\xa0String!\nresource:\xa0String\noperationType:\xa0OpType!\nincludeAllAccounts:\xa0Boolean\npolicies(**...**):\xa0\\[Policy!\\]\nscopes(**...**):\xa0\\[String!\\]!\noperations(**...**):\xa0\\[String\\]!\n}\n")),Object(o.b)("p",null,"Permissions are based upon various operations the subject wants to perform on the object."),Object(o.b)("h5",{id:"update-delete-and-trash-link-and-unlinking-a-resource"},"Update, Delete and Trash, Link and Unlinking a resource"),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"#"},"Mutation")," permissions may be granted to the subject. It includes update, delete, trash, link, and unlink permissions. All of these functions operate on existing resources. Permission object generates an authorisation request for mutations."),Object(o.b)("h5",{id:"searching-for-resources"},"Searching for resources"),Object(o.b)("p",null,"The platform uses\xa0",Object(o.b)("a",{parentName:"p",href:"#"},"ArcQL"),"\xa0query language for finding data. All requests to get data, no matter how trivial the query, goes through ArcQL. During a search, resources that match that search are further filtered down to only those that the subject is allowed to see. So, only certain types of records a subject can access through a query. For example, a password is a resource that is not accessible to any subject except the user."),Object(o.b)("h5",{id:"implicit-permission"},"Implicit Permission"),Object(o.b)("p",null,"If no\xa0",Object(o.b)("inlineCode",{parentName:"p"},"Permission"),"\xa0is given explicitly, the platform acts as if one is implicitly created with an\xa0",Object(o.b)("inlineCode",{parentName:"p"},"AccountPolicy"),". This permission grants access to the\xa0",Object(o.b)("inlineCode",{parentName:"p"},"Account"),"\xa0which created the object. So, the creator of an object has complete access to it by default - no one else does."),Object(o.b)("h4",{id:"examples"},"Examples"),Object(o.b)("p",null,"Let's look at functions related to Permission."),Object(o.b)("h5",{id:"permission-1"},"Permission"),Object(o.b)("p",null,"The below example demonstrates how to create permission to an account to access an object's details."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'mutation {\n  upsert(\n    values: {\n      Permission: [\n        {\n          name: "Grant access to anonymous user"\n          decisionStrategy: Unanimous\n          type: "File"\n          resource: "<file-id>"\n          scopes: ["*"]\n          operationType: Query\n          operations: ["find"]\n          #includeAllAccounts: true, //wildcard so all accounts can access\n          policies: [\n            {\n              hypi: { impl: "AccountPolicy" }\n              name: "Grant user anonymous access to my file"\n              logic: Positive\n              accounts: [{ hypi: { id: "anonymous" } }]\n            }\n          ]\n        }\n      ]\n    }\n  ) {\n    id\n  }\n}\n\n')),Object(o.b)("p",null,"Let's check the parameters."),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",{parentName:"tr",align:null},"Parameter"),Object(o.b)("th",{parentName:"tr",align:null},"Type"),Object(o.b)("th",{parentName:"tr",align:null},"Description"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"Name")),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"The description of the permission")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"decisionStrategy")),Object(o.b)("td",{parentName:"tr",align:null},"DecisionStrategy"),Object(o.b)("td",{parentName:"tr",align:null},"Defines how the policy arrives at a decision, defaults to Unanimous")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"Type")),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"The type or an object that this permission applies to")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"resource")),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"If present then the scopes in this permission will have the given policies applied to this resource.")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"operationType")),Object(o.b)("td",{parentName:"tr",align:null},"OpType"),Object(o.b)("td",{parentName:"tr",align:null},"Query, Mutation, or Subscription")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"includeAllAccounts")),Object(o.b)("td",{parentName:"tr",align:null},"Boolean"),Object(o.b)("td",{parentName:"tr",align:null},"If true, this permission grants/denies access to all accounts (including anonymous account)")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"policies")),Object(o.b)("td",{parentName:"tr",align:null},"Policy"),Object(o.b)("td",{parentName:"tr",align:null},"Give access to specific users, groups, etc instead of to all accounts")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"scopes")),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"An array of the fields to grant access to. Not permitted to access other fields. Use `*\u2019 to give access to all fields.")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:null},Object(o.b)("em",{parentName:"td"},"operations")),Object(o.b)("td",{parentName:"tr",align:null},"String"),Object(o.b)("td",{parentName:"tr",align:null},"a list of fields in the operationType e.g. find, upsert, or any custom method")))),Object(o.b)("h5",{id:"haspermission"},"hasPermission"),Object(o.b)("p",null,"You may check if the user has permission to access an object's details. You can use the function ",Object(o.b)("inlineCode",{parentName:"p"},"hasPermission")," for that. The below example demonstrates how to use the function. Refer to the table above to know about the parameters. Make sure you have passed the appropriate session token as the \u201cAuthorization\u201d parameter in the HTTP header. You get a session token after ",Object(o.b)("a",{parentName:"p",href:"#"},"login")," into the account"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'{ \n   hasPermission(req:{\n     opType:Mutation,\n     operationName:"upsert",\n     type:"Account",\n     resource:"01F0R0BJ9XGDHS2GGM7YY4Y7M1"\n     scopes:"username"\n })\n}\n')),Object(o.b)("p",null,"The function returns ",Object(o.b)("inlineCode",{parentName:"p"},"true")," if the user has requested permission. Otherwise, it returns ",Object(o.b)("inlineCode",{parentName:"p"},"false"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n     "hasPermission": [true]\n  }\n}\n')),Object(o.b)("h5",{id:"me"},"me"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"me")," function returns the details of various permissions for a user. You may access the information of permissions provided to various groups, accounts, roles, realms, and clients. This function returns an object of type PermissionDescription"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type PermissionDescription\xa0{\n    hypi:\xa0Hypi\n    roles:\xa0[Role!]\n    groups:\xa0[Group!]\n    organisations:\xa0[Organisation!]\n    realms:\xa0[Realm!]\n    permissions(...):\xa0[Permission]\n}\n")),Object(o.b)("p",null,"You may simply use the fields of PermissionDescription to access permission details. Information about the group/organization/role should have been stored while ",Object(o.b)("a",{parentName:"p",href:"#"},"creating the user account"),". Otherwise, the fields would return a null value."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},"{\n   me{\n        roles{\n            name\n        }\n        organisations{\n            name\n            phones{\n            number\n            }\n        }\n        permissions{\n            operations\n            operationType\n        }\n    }\n}\n\n")))}p.isMDXComponent=!0},119:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,d=u["".concat(i,".").concat(m)]||u[m]||b[m]||o;return n?r.a.createElement(d,s(s({ref:t},l),{},{components:n})):r.a.createElement(d,s({ref:t},l))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);