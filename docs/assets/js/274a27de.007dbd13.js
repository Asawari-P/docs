(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{163:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=r.a.createContext({}),s=function(e){var n=r.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},b=function(e){var n=s(e.components);return r.a.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),b=s(t),d=a,m=b["".concat(o,".").concat(d)]||b[d]||p[d]||i;return t?r.a.createElement(m,l(l({ref:n},c),{},{components:t})):r.a.createElement(m,l({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=d;var l={};for(var u in n)hasOwnProperty.call(n,u)&&(l[u]=n[u]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=t[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},164:function(e,n,t){"use strict";function a(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=a(e[n]))&&(r&&(r+=" "),r+=t);else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}n.a=function(){for(var e,n,t=0,r="";t<arguments.length;)(e=arguments[t++])&&(n=a(e))&&(r&&(r+=" "),r+=n);return r}},165:function(e,n,t){"use strict";var a=t(0),r=t(166);n.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},166:function(e,n,t){"use strict";var a=t(0),r=Object(a.createContext)(void 0);n.a=r},167:function(e,n,t){"use strict";var a=t(0),r=t.n(a),i=t(165),o=t(164),l=t(57),u=t.n(l);var c=37,s=39;n.a=function(e){var n=e.lazy,t=e.block,l=e.defaultValue,b=e.values,p=e.groupId,d=e.className,m=Object(i.a)(),f=m.tabGroupChoices,y=m.setTabGroupChoices,h=Object(a.useState)(l),v=h[0],O=h[1],j=a.Children.toArray(e.children),g=[];if(null!=p){var N=f[p];null!=N&&N!==v&&b.some((function(e){return e.value===N}))&&O(N)}var w=function(e){var n=e.target,t=g.indexOf(n),a=j[t].props.value;O(a),null!=p&&(y(p,a),setTimeout((function(){var e,t,a,r,i,o,l,c;(e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.bottom,i=e.right,o=window,l=o.innerHeight,c=o.innerWidth,t>=0&&i<=c&&r<=l&&a>=0)||(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add(u.a.tabItemActive),setTimeout((function(){return n.classList.remove(u.a.tabItemActive)}),2e3))}),150))},C=function(e){var n,t;switch(e.keyCode){case s:var a=g.indexOf(e.target)+1;t=g[a]||g[0];break;case c:var r=g.indexOf(e.target)-1;t=g[r]||g[g.length-1]}null===(n=t)||void 0===n||n.focus()};return r.a.createElement("div",{className:"tabs-container"},r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(o.a)("tabs",{"tabs--block":t},d)},b.map((function(e){var n=e.value,t=e.label;return r.a.createElement("li",{role:"tab",tabIndex:v===n?0:-1,"aria-selected":v===n,className:Object(o.a)("tabs__item",u.a.tabItem,{"tabs__item--active":v===n}),key:n,ref:function(e){return g.push(e)},onKeyDown:C,onFocus:w,onClick:w},t)}))),n?Object(a.cloneElement)(j.filter((function(e){return e.props.value===v}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},j.map((function(e,n){return Object(a.cloneElement)(e,{key:n,hidden:e.props.value!==v})}))))}},168:function(e,n,t){"use strict";var a=t(0),r=t.n(a);n.a=function(e){var n=e.children,t=e.hidden,a=e.className;return r.a.createElement("div",{role:"tabpanel",hidden:t,className:a},n)}},88:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return u})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return p}));var a=t(3),r=t(8),i=(t(0),t(163)),o=t(167),l=t(168),u={id:"userdefinedfunctions",title:"User Defined Functions",sidebar_label:"User Defined Functions",slug:"/user-defined-function"},c={unversionedId:"userdefinedfunctions",id:"userdefinedfunctions",isDocsHomePage:!1,title:"User Defined Functions",description:"User Defined functions provide a lightweight way to implement custom behaviour outside of what Hypi offers. The functions are executed on the same server where the query gets processed.",source:"@site/content/userdefinedfunctions.md",slug:"/user-defined-function",permalink:"/docs/user-defined-function",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/userdefinedfunctions.md",version:"current",sidebar_label:"User Defined Functions",sidebar:"docs",previous:{title:"Hypi Directives",permalink:"/docs/hypi-directives"},next:{title:"Workflow",permalink:"/docs/workflow"}},s=[{value:"Function \u2018gql\u2019",id:"function-gql",children:[]}],b={toc:s};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"User Defined functions provide a lightweight way to implement custom behaviour outside of what Hypi offers. The functions are executed on the same server where the query gets processed."),Object(i.b)("p",null,"Currently, you may use two programming language for the user defined functions."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Groovy: The entire Groovy syntax is available on the hypi platform. Groovy is a general programming language. Adding custom behaviour using Groovy becomes quick, easy and performant.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Velocity: The velocity template language is in place to output text. This text may execute dynamic behaviour. E.g., customizing the body of an email, substituting receiver\u2019s name from a variable etc."))),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Let\u2019s check how to implement user defined functions. ")),Object(i.b)("p",null,"We will start with a simple schema as follows: "),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'type Query {\n    inlineGroovyFunction(a: String, b: Int, c: Boolean)\n        :Json @tan(type:Groovy, inline: """\n        def map = new java.util.LinkedHashMap()\n        map.put("a", a)\n        map.put("b", b)\n        map.put("c", c)\n        return map\n    """)\n    inlineVelocityFunction(a: String, b: Int, c: Boolean):\n    String @tan(type:Velocity, inline: "$a,$b,$c")\n}\n')),Object(i.b)("p",null,"The schema has two user defined functions. ",Object(i.b)("inlineCode",{parentName:"p"},"inlineGroovyFunction")," and ",Object(i.b)("inlineCode",{parentName:"p"},"inlineVelocityFunction")," You may define the user defined functions either inline or through a script. ",Object(i.b)("inlineCode",{parentName:"p"},"@tan")," directive is used to add the functions. "),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"inlineGroovyFunction")," function puts value of variables a,b and c in a LinkedHashMap and the map is returned in the form of JSON data. ",Object(i.b)("inlineCode",{parentName:"p"},"inlineVelocityFunction")," uses velocity template to return the formatted string output of variables a,b, and c. You may execute the user defined function as any other GraphQL query."),Object(i.b)(o.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(i.b)(l.a,{value:"query",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'{\n  inlineGroovyFunction(a:"val1", b:23, c: true)\n}\nOR\n{\n  inlineVelocityFunction(a:"val1", b:23, c: true)\n}\n\n'))),Object(i.b)(l.a,{value:"response",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "inlineGroovyFunction": {\n      "a": "val1",\n      "b": 23,\n      "c": true\n    }\n  }\n}\nOR\n{\n  "data": {\n    "inlineVelocityFunction": "val1,23,true"\n  }\n}\n')))),Object(i.b)("p",null,"You may pass the variable parameters to the function as well. Just like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"query inlineVelocityFunction($a: String, $b: Int, $c: Boolean){\n  inlineVelocityFunction(a: $a, b: $b, c: $c)\n}\n")),Object(i.b)("p",null,"As you can see in ",Object(i.b)("inlineCode",{parentName:"p"},"inlineGroovyFunction"),", Java classes are also available to use inline. You may also use a simple Groovy like version as follows."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'inlineGroovyFunction(a: String, b: Int, c: Boolean):Json @tan(type:Groovy, inline: """\n     return [\n     a: a,\n     b: b,\n     c: c\n     ]\n """)\n')),Object(i.b)("h3",{id:"function-gql"},"Function \u2018gql\u2019"),Object(i.b)("p",null,"The function 'gql' is available to execute inside the user defined function. Using this function you may perform mutation or query operations inside the user defined function. The result depends upon the type of operation. If you perform an ",Object(i.b)("inlineCode",{parentName:"p"},"upsert")," mutation, it will return id, createdBy etc. (Just like the normal ",Object(i.b)("inlineCode",{parentName:"p"},"upsert")," in Hypi) If you perform a ",Object(i.b)("inlineCode",{parentName:"p"},"find")," query, it will return a list."),Object(i.b)("p",null,"Let\u2019s check a few examples of how to use this function. Add the following schema in GraphQL."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'type Mutation {\n  SetBookInfo(a: String, b: Float, c: Int):Json @tan(type:Groovy, inline: """\n    return [ gql(\\"""\n    mutation {\n        upsert(\n            values: { \n                Book: [\n                    { \n                        title: "$a",\n                        price: $b,\n                        authorid: $c\n                    }\n                ] \n            }\n        ) {\n            id\n        }\n    }\\"""\n    )\n    ]\n  """)\n}\ntype Query {\n  GetAuthorInfo(a: String):Json @tan(type:Groovy, inline: """\n    return [ gql(\\"""\n    query {\n           get(type: Author, id: "$a"){\n            ... on Author {\n            hypi{\n                id               \n            }\n            name\n            booklist{\n                title               \n                price\n                authorid \n            }\n        }\n        \n    }\n    }\\"""\n    )\n    ]\n  """)\n}                                                         \n')),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"SetBookInfo")," is a user defined function to set parameter values inside the table ",Object(i.b)("inlineCode",{parentName:"p"},"Book"),". Upon successful creation of the object, the ",Object(i.b)("inlineCode",{parentName:"p"},"hypi.id")," is returned."),Object(i.b)(o.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(i.b)(l.a,{value:"query",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'mutation {\n  SetBookInfo(a:"Ikigai", b:6.99, c: 7)\n}\n'))),Object(i.b)(l.a,{value:"response",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'{\n  "data": {\n    "SetBookInfo": [\n      {\n        "data": {\n          "upsert": [\n            {\n              "id": "01F1F23WERW6V4JQYDRW4QQRBQ"\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n')))),Object(i.b)("p",null,"Let's retrieve ",Object(i.b)("inlineCode",{parentName:"p"},"Author")," table data using ",Object(i.b)("inlineCode",{parentName:"p"},"GetAthorInfo"),". Pass the Author id as ",Object(i.b)("inlineCode",{parentName:"p"},"Author1")," .It returns the author infomation with id 'Author1'"),Object(i.b)(o.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(i.b)(l.a,{value:"query",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'query{\n  GetAuthorInfo(a:"Author1")\n}\n'))),Object(i.b)(l.a,{value:"response",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "GetAuthorInfo": [\n      {\n        "data": {\n          "get": {\n            "hypi": {\n              "id": "Author1"\n            },\n            "name": "Dan Brown",\n            "booklist": [\n              {\n                "title": "Da Vinci Code",\n                "price": 12.99,\n                "authorid": 1\n              }\n            ]\n          }\n        }\n      }\n    ]\n  }\n}\n')))),Object(i.b)("p",null,"The",Object(i.b)("inlineCode",{parentName:"p"},"gql"),"function accepts two parameters."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"query"),": String - the GraphQL query to execute"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"values"),": Map - a map containing the set of variables used in ",Object(i.b)("inlineCode",{parentName:"li"},"query"))),Object(i.b)("p",null,"In the above examples, we have just used GraphQL query string. Let's modify the ",Object(i.b)("inlineCode",{parentName:"p"},"SetBookInfo")," function with Map values."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"type Mutation {\n  SetBookInfo(a: String, b: Float, c: Int):Json @tan(type:Groovy, inline: \"\"\"\n    return gql('''\n    mutation CreateBook($p: String, $q: Float, $r: Int){\n        upsert(\n            values: { \n                Book: [\n                    { \n                        title: $p,\n                        price: $q,\n                        authorid: $r\n                    }\n                ] \n            }\n        ) {\n            id\n        }\n    }''', ['p':a , 'q': b, 'r': c])\n  \"\"\")\n}\n")),Object(i.b)("p",null,"Notice few changes here:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Replaced the ",Object(i.b)("inlineCode",{parentName:"li"},'\\"""')," with just ",Object(i.b)("inlineCode",{parentName:"li"},"'''")," . Using three ",Object(i.b)("inlineCode",{parentName:"li"},"'")," in Groovy, we have the same effect as ",Object(i.b)("inlineCode",{parentName:"li"},'"""'),". without string interpolation. It means that ",Object(i.b)("inlineCode",{parentName:"li"},"$a")," is not evaluated as a Groovy variable and remains as a part of the string."),Object(i.b)("li",{parentName:"ul"},"Added GraphQL variables ",Object(i.b)("inlineCode",{parentName:"li"},"CreateBook($p: String, $q: Float, $r: Int)")),Object(i.b)("li",{parentName:"ul"},"Added variable values ",Object(i.b)("inlineCode",{parentName:"li"},"['p':a, 'q': b, 'r': c]")," in the map. Now, the variables ",Object(i.b)("inlineCode",{parentName:"li"},"$p")," , ",Object(i.b)("inlineCode",{parentName:"li"},"$q")," and ",Object(i.b)("inlineCode",{parentName:"li"},"$r")," are GraphQL variables not Groovy variables.")),Object(i.b)("p",null,"With these changes, the result is the same as the previous example!"))}p.isMDXComponent=!0}}]);