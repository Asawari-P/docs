(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{105:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return l})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return b}));var n=a(3),r=a(8),i=(a(0),a(182)),o={id:"openwhisk-triggers",title:"Triggers and Rules",sidebar_label:"Triggers and Rules",slug:"/openwhisk-triggers"},l={unversionedId:"openwhisk-triggers",id:"openwhisk-triggers",isDocsHomePage:!1,title:"Triggers and Rules",description:"OpenWhisk triggers and rules bring event-driven capabilities to the platform. Events from external and internal event sources are channeled through a trigger, and rules allow your actions to react to these events.",source:"@site/content/openwhisk-triggers.md",slug:"/openwhisk-triggers",permalink:"/docs/openwhisk-triggers",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/openwhisk-triggers.md",version:"current",sidebar_label:"Triggers and Rules",sidebar:"docs",previous:{title:"Annotations",permalink:"/docs/openwhisk-annotations"},next:{title:"Action Sequences",permalink:"/docs/openwhisk-sequences"}},c=[{value:"Creating triggers",id:"creating-triggers",children:[]},{value:"Using rules",id:"using-rules",children:[]},{value:"Creating and firing triggers",id:"creating-and-firing-triggers",children:[]},{value:"Associating triggers and actions by using rules",id:"associating-triggers-and-actions-by-using-rules",children:[]}],s={toc:c};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"OpenWhisk triggers and rules bring event-driven capabilities to the platform. Events from external and internal event sources are channeled through a trigger, and rules allow your actions to react to these events."),Object(i.b)("h3",{id:"creating-triggers"},"Creating triggers"),Object(i.b)("p",null,"Triggers are a named channel for a class of events. The following are examples of triggers:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"A trigger of location update events."),Object(i.b)("li",{parentName:"ul"},"A trigger of document uploads to a website."),Object(i.b)("li",{parentName:"ul"},"A trigger of incoming emails.")),Object(i.b)("p",null,"Triggers can be ",Object(i.b)("em",{parentName:"p"},"fired")," (activated) by using a dictionary of key-value pairs. Sometimes this dictionary is referred to as the ",Object(i.b)("em",{parentName:"p"},"event"),". As with actions, each firing of a trigger results in an activation ID."),Object(i.b)("p",null,"Triggers can be explicitly fired by a user or fired on behalf of a user by an external event source.\nA ",Object(i.b)("em",{parentName:"p"},"feed")," is a convenient way to configure an external event source to fire trigger events that can be consumed by OpenWhisk. Examples of feeds include the following:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Cloudant data change feed that fires a trigger event each time a document in a database is added or modified."),Object(i.b)("li",{parentName:"ul"},"A Git feed that fires a trigger event for every commit to a Git repository.")),Object(i.b)("h3",{id:"using-rules"},"Using rules"),Object(i.b)("p",null,"A rule associates one trigger with one action, with every firing of the trigger causing the corresponding action to be invoked with the trigger event as input."),Object(i.b)("p",null,"With the appropriate set of rules, it's possible for a single trigger event to invoke multiple actions, or for an action to be invoked as a response to events from multiple triggers."),Object(i.b)("p",null,"For example, consider a system with the following actions:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"classifyImage")," action that detects the objects in an image and classifies them."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"thumbnailImage")," action that creates a thumbnail version of an image.")),Object(i.b)("p",null,"Also, suppose that there are two event sources that are firing the following triggers:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"newTweet")," trigger that is fired when a new tweet is posted."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"imageUpload")," trigger that is fired when an image is uploaded to a website.")),Object(i.b)("p",null,"You can set up rules so that a single trigger event invokes multiple actions, and have multiple triggers invoke the same action:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"newTweet -> classifyImage")," rule."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"imageUpload -> classifyImage")," rule."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"imageUpload -> thumbnailImage")," rule.")),Object(i.b)("p",null,"The three rules establish the following behavior: images in both tweets and uploaded images are classified, uploaded images are classified, and a thumbnail version is generated."),Object(i.b)("h3",{id:"creating-and-firing-triggers"},"Creating and firing triggers"),Object(i.b)("p",null,"Triggers can be fired when certain events occur, or can be fired manually."),Object(i.b)("p",null,"As an example, create a trigger to send user location updates, and manually fire the trigger."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Enter the following command to create the trigger:")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk trigger create locationUpdate\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"ok: created trigger locationUpdate\n")),Object(i.b)("ol",{start:2},Object(i.b)("li",{parentName:"ol"},"Check that you created the trigger by listing the set of triggers.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk trigger list\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"triggers\n/someNamespace/locationUpdate                            private\n")),Object(i.b)("p",null,'So far you\'ve created a named "channel" to which events can be fired.'),Object(i.b)("ol",{start:3},Object(i.b)("li",{parentName:"ol"},"Next, fire a trigger event by specifying the trigger name and parameters:")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'$ wsk trigger fire locationUpdate --param name Donald --param place "Washington, D.C."\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"ok: triggered locationUpdate with id fa495d1223a2408b999c3e0ca73b2677\n")),Object(i.b)("p",null,"A trigger that is fired without an accompanying rule to match against has no visible effect.\nTriggers cannot be created inside a package; they must be created directly under a namespace."),Object(i.b)("h3",{id:"associating-triggers-and-actions-by-using-rules"},"Associating triggers and actions by using rules"),Object(i.b)("p",null,"Rules are used to associate a trigger with an action. Each time a trigger event is fired, the action is invoked with the event parameters."),Object(i.b)("p",null,"As an example, create a rule that calls the hello action whenever a location update is posted."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Create a 'hello.js' file with the action code we will use:")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"function main(params) {\n return {payload:  'Hello, ' + params.name + ' from ' + params.place};\n}\n")),Object(i.b)("ol",{start:2},Object(i.b)("li",{parentName:"ol"},"Make sure that the trigger and action exist.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk trigger update locationUpdate\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk action update hello hello.js\n")),Object(i.b)("ol",{start:3},Object(i.b)("li",{parentName:"ol"},"Create the rule. Note that the rule will be enabled upon creation, meaning that it will be immediately available to respond to activations of your trigger. The three parameters are the name of the rule, the trigger, and the action.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk rule create myRule locationUpdate hello\n")),Object(i.b)("p",null,"At any time, you can choose to disable a rule."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk rule disable myRule\n")),Object(i.b)("ol",{start:4},Object(i.b)("li",{parentName:"ol"},"Fire the locationUpdate trigger. Each time that you fire an event, the hello action is called with the event parameters.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'$ wsk trigger fire locationUpdate --param name Donald --param place "Washington, D.C."\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"ok: triggered locationUpdate with id 878998285cad448b8998285cad948b30\n")),Object(i.b)("ol",{start:5},Object(i.b)("li",{parentName:"ol"},"Verify that the action was invoked by checking the most recent activation.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk activation list --limit 1 hello\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"Datetime            Activation ID                    Kind     Start Duration   Status  Entity\n2019-02-18 11:51:41 0efe54d8fb96486bbe54d8fb96d86bbe nodejs:6 cold  54ms       success guest/hello:0.0.1\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk activation result 0efe54d8fb96486bbe54d8fb96d86bbe\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'{\n "payload": "Hello, Donald from Washington, D.C."\n}\n')),Object(i.b)("p",null,"You see that the hello action received the event payload and returned the expected string."),Object(i.b)("p",null,"You can create multiple rules that associate the same trigger with different actions.\nTriggers and rules cannot belong to a package. The rule may be associated with an action\nthat belongs to a package however, for example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk rule create recordLocation locationUpdate /whisk.system/utils/echo\n")),Object(i.b)("p",null,"You can also use rules with sequences. For example, one can create an action\nsequence ",Object(i.b)("inlineCode",{parentName:"p"},"recordLocationAndHello")," that is activated by the rule ",Object(i.b)("inlineCode",{parentName:"p"},"anotherRule"),"."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ wsk action create recordLocationAndHello --sequence /whisk.system/utils/echo,hello\n$ wsk rule create anotherRule locationUpdate recordLocationAndHello\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"Large portions of this page is copied from the Apache OpenWhisk documentation in ",Object(i.b)("a",{parentName:"p",href:"https://github.com/apache/openwhisk/tree/master/docs"},"https://github.com/apache/openwhisk/tree/master/docs")," on April 23rd 2021 - where there have been customisations to match Hypi's deployment this has been noted. Apache OpenWhisk and the Apache name are the property of the Apache Foundation and licensed under the ",Object(i.b)("a",{parentName:"p",href:"https://github.com/apache/openwhisk/blob/master/LICENSE.txt"},"Apache V2 license")," ."))))}b.isMDXComponent=!0},182:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return g}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=r.a.createContext({}),b=function(e){var t=r.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=b(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=b(a),d=n,g=p["".concat(o,".").concat(d)]||p[d]||u[d]||i;return a?r.a.createElement(g,l(l({ref:t},s),{},{components:a})):r.a.createElement(g,l({ref:t},s))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);