(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{191:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=r.a.createContext({}),b=function(e){var n=r.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=b(e.components);return r.a.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),s=b(t),d=a,m=s["".concat(i,".").concat(d)]||s[d]||p[d]||o;return t?r.a.createElement(m,l(l({ref:n},c),{},{components:t})):r.a.createElement(m,l({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var l={};for(var u in n)hasOwnProperty.call(n,u)&&(l[u]=n[u]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=t[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},192:function(e,n,t){"use strict";function a(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=a(e[n]))&&(r&&(r+=" "),r+=t);else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}n.a=function(){for(var e,n,t=0,r="";t<arguments.length;)(e=arguments[t++])&&(n=a(e))&&(r&&(r+=" "),r+=n);return r}},193:function(e,n,t){"use strict";var a=t(0),r=t(194);n.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},194:function(e,n,t){"use strict";var a=t(0),r=Object(a.createContext)(void 0);n.a=r},195:function(e,n,t){"use strict";var a=t(0),r=t.n(a),o=t(193),i=t(192),l=t(57),u=t.n(l);var c=37,b=39;n.a=function(e){var n=e.lazy,t=e.block,l=e.defaultValue,s=e.values,p=e.groupId,d=e.className,m=Object(o.a)(),y=m.tabGroupChoices,h=m.setTabGroupChoices,v=Object(a.useState)(l),f=v[0],O=v[1],j=a.Children.toArray(e.children),g=[];if(null!=p){var N=y[p];null!=N&&N!==f&&s.some((function(e){return e.value===N}))&&O(N)}var T=function(e){var n=e.target,t=g.indexOf(n),a=j[t].props.value;O(a),null!=p&&(h(p,a),setTimeout((function(){var e,t,a,r,o,i,l,c;(e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.bottom,o=e.right,i=window,l=i.innerHeight,c=i.innerWidth,t>=0&&o<=c&&r<=l&&a>=0)||(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add(u.a.tabItemActive),setTimeout((function(){return n.classList.remove(u.a.tabItemActive)}),2e3))}),150))},I=function(e){var n,t;switch(e.keyCode){case b:var a=g.indexOf(e.target)+1;t=g[a]||g[0];break;case c:var r=g.indexOf(e.target)-1;t=g[r]||g[g.length-1]}null===(n=t)||void 0===n||n.focus()};return r.a.createElement("div",{className:"tabs-container"},r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":t},d)},s.map((function(e){var n=e.value,t=e.label;return r.a.createElement("li",{role:"tab",tabIndex:f===n?0:-1,"aria-selected":f===n,className:Object(i.a)("tabs__item",u.a.tabItem,{"tabs__item--active":f===n}),key:n,ref:function(e){return g.push(e)},onKeyDown:I,onFocus:T,onClick:T},t)}))),n?Object(a.cloneElement)(j.filter((function(e){return e.props.value===f}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},j.map((function(e,n){return Object(a.cloneElement)(e,{key:n,hidden:e.props.value!==f})}))))}},196:function(e,n,t){"use strict";var a=t(0),r=t.n(a);n.a=function(e){var n=e.children,t=e.hidden,a=e.className;return r.a.createElement("div",{role:"tabpanel",hidden:t,className:a},n)}},94:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return u})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return b})),t.d(n,"default",(function(){return p}));var a=t(3),r=t(8),o=(t(0),t(191)),i=t(195),l=t(196),u={id:"userdefinedfunctions",title:"User Defined Functions",sidebar_label:"User Defined Functions",slug:"/user-defined-function"},c={unversionedId:"userdefinedfunctions",id:"userdefinedfunctions",isDocsHomePage:!1,title:"User Defined Functions",description:"User Defined functions provide a lightweight way to implement custom behaviour outside of what Hypi offers. The functions are executed on the same server where the query gets processed.",source:"@site/content/userdefinedfunctions.md",slug:"/user-defined-function",permalink:"/docs/user-defined-function",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/userdefinedfunctions.md",version:"current",sidebar_label:"User Defined Functions",sidebar:"docs",previous:{title:"Hypi Directives",permalink:"/docs/hypi-directives"},next:{title:"Workflow",permalink:"/docs/workflow"}},b=[{value:"User Defined Functions using APIs",id:"user-defined-functions-using-apis",children:[{value:"upsert",id:"upsert",children:[]},{value:"find",id:"find",children:[]},{value:"get",id:"get",children:[]},{value:"trash",id:"trash",children:[]},{value:"untrash",id:"untrash",children:[]},{value:"delete",id:"delete",children:[]},{value:"deleteScalars",id:"deletescalars",children:[]},{value:"link",id:"link",children:[]},{value:"unlink",id:"unlink",children:[]},{value:"createAccount",id:"createaccount",children:[]},{value:"login / loginByEmail",id:"login--loginbyemail",children:[]},{value:"Maths APIs",id:"maths-apis",children:[]},{value:"parseJSON",id:"parsejson",children:[]},{value:"parseXML",id:"parsexml",children:[]},{value:"Function \u2018gql\u2019",id:"function-gql",children:[]}]}],s={toc:b};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"User Defined functions provide a lightweight way to implement custom behaviour outside of what Hypi offers. The functions are executed on the same server where the query gets processed."),Object(o.b)("p",null,"Currently, you may use two programming language for the user defined functions."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Groovy: The entire Groovy syntax is available on the hypi platform. Groovy is a general programming language. Adding custom behaviour using Groovy becomes quick, easy and performant.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Velocity: The velocity template language is in place to output text. This text may execute dynamic behaviour. E.g., customizing the body of an email, substituting receiver\u2019s name from a variable etc."))),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Let\u2019s check how to implement user defined functions. ")),Object(o.b)("p",null,"We will start with a simple schema as follows: "),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'type Query {\n    inlineGroovyFunction(a: String, b: Int, c: Boolean)\n        :Json @tan(type:Groovy, inline: """\n        def map = new java.util.LinkedHashMap()\n        map.put("a", a)\n        map.put("b", b)\n        map.put("c", c)\n        return map\n    """)\n    inlineVelocityFunction(a: String, b: Int, c: Boolean):\n    String @tan(type:Velocity, inline: "$a,$b,$c")\n}\n')),Object(o.b)("p",null,"The schema has two user defined functions. ",Object(o.b)("inlineCode",{parentName:"p"},"inlineGroovyFunction")," and ",Object(o.b)("inlineCode",{parentName:"p"},"inlineVelocityFunction")," You may define the user defined functions either inline or through a script. ",Object(o.b)("inlineCode",{parentName:"p"},"@tan")," directive is used to add the functions. "),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"inlineGroovyFunction")," function puts value of variables a,b and c in a LinkedHashMap and the map is returned in the form of JSON data. ",Object(o.b)("inlineCode",{parentName:"p"},"inlineVelocityFunction")," uses velocity template to return the formatted string output of variables a,b, and c. You may execute the user defined function as any other GraphQL query."),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'{\n  inlineGroovyFunction(a:"val1", b:23, c: true)\n}\nOR\n{\n  inlineVelocityFunction(a:"val1", b:23, c: true)\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "inlineGroovyFunction": {\n      "a": "val1",\n      "b": 23,\n      "c": true\n    }\n  }\n}\nOR\n{\n  "data": {\n    "inlineVelocityFunction": "val1,23,true"\n  }\n}\n')))),Object(o.b)("p",null,"You may pass the variable parameters to the function as well. Just like this:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"query inlineVelocityFunction($a: String, $b: Int, $c: Boolean){\n  inlineVelocityFunction(a: $a, b: $b, c: $c)\n}\n")),Object(o.b)("p",null,"As you can see in ",Object(o.b)("inlineCode",{parentName:"p"},"inlineGroovyFunction"),", Java classes are also available to use inline. You may also use a simple Groovy like version as follows."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'inlineGroovyFunction(a: String, b: Int, c: Boolean):Json @tan(type:Groovy, inline: """\n     return [\n     a: a,\n     b: b,\n     c: c\n     ]\n """)\n')),Object(o.b)("h2",{id:"user-defined-functions-using-apis"},"User Defined Functions using APIs"),Object(o.b)("p",null,"It is easy to call CRUD APIs, Math APIs, Authentication functions from User Defined Functions. You may parse JSON and XML data inside User Defined Function as well. "),Object(o.b)("p",null,"Let's check how to implement these functions."),Object(o.b)("h3",{id:"upsert"},"upsert"),Object(o.b)("p",null,"Look at the ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUpsert")," user defined function below. It can be used to insert or update data in an object.  Its behaviour is the same as the ",Object(o.b)("a",{parentName:"p",href:"/docs/create-data"},"upsert")," function from ",Object(o.b)("a",{parentName:"p",href:"/docs/crud"},"CRUD APIs"),". ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUpsert")," inserts data in the ",Object(o.b)("inlineCode",{parentName:"p"},"Author")," and ",Object(o.b)("inlineCode",{parentName:"p"},"Book")," objects. You may use appropriate name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUpsert")," as per its behaviour."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},'type Mutation {\n  groovyUpsert(a: String, b: Int, c: Int, d: String, e:String, f: Boolean):Json\n  @tan(type:Groovy, inline: """return upsert([\n          Author: [\n           [             \n             name: a,\n             age: b,\n             count: c,\n             booklist:[\n                [\n                 title: d,\n                 publication: e,\n                 available: f\n                ]\n             ]\n           ]\n          ]\n        ]\n    )  \n  """\n  ) \n}\n')),Object(o.b)("p",null,"Note there is a slight change of syntax for the upsert function. Since it is written in Groovy, we have used square brackets instead of curly brackets."),Object(o.b)("p",null,"Here is the execution of the function."),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation{\n  groovyUpsert(a:"Dan Brown", b: 56, c:3, d: "Da Vinci Code", e: "abc", f: true)\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyUpsert": [\n      {\n        "__typename": "Hypi",\n        "id": "01F9V5QJDFV5MJWSQ0KV13N5PN",\n        "impl": null,\n        "created": "2021-07-05T11:09:24Z",\n        "updated": "2021-07-05T11:09:24Z",\n        "trashed": null,\n        "createdBy": "01F2GA50NFXHMYCBDNYFJK1V7R",\n        "instanceId": "01F9V52Z4NW0CBTNS7QG7G3RAE",\n        "tags": null\n      }\n    ]\n  }\n}\n')))),Object(o.b)("p",null,"To ",Object(o.b)("a",{parentName:"p",href:"/docs/update-data"},"update an existing object"),", we will do a slight modification in the schema. Let's add a parameter to pass hypi.id to update an existing object."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation {\n  groovyUpsert(a: String, b: Int, c: Int, d: String, e:String, f: Boolean, g: ID):Json\n  @tan(type:Groovy, inline: """return upsert([\n          Author: [\n           [ \n             hypi:[\n                 id: g\n             ],            \n             name: a,\n             age: b,\n             count: c,\n             booklist:[\n                [\n                 title: d,\n                 publication: e,\n                 available: f\n                ]\n             ]\n           ]\n          ]\n        ]\n    )  \n  """\n  ) \n}\n')),Object(o.b)("p",null,"Here is the execution of function."),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation{\n  groovyUpsert( d: "Inferno", e: "xyz", f: true, g: "01F9V5QJDFV5MJWSQ0KV13N5PN")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyUpsert": [\n      {\n        "__typename": "Hypi",\n        "id": "01F9V5QJDFV5MJWSQ0KV13N5PN",\n        "impl": null,\n        "created": null,\n        "updated": "2021-07-05T11:18:26Z",\n        "trashed": null,\n        "createdBy": null,\n        "instanceId": "01F9V52Z4NW0CBTNS7QG7G3RAE",\n        "tags": null\n      }\n    ]\n  }\n}\n')))),Object(o.b)("h3",{id:"find"},"find"),Object(o.b)("p",null,"Below user defined function (",Object(o.b)("inlineCode",{parentName:"p"},"groovyFind"),") can be used to retrieve all the data from an object.  Its behaviour is the same as the ",Object(o.b)("a",{parentName:"p",href:"/docs/read-data#find"},"find")," function from CRUD APIs.  Use appropriate name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyFind")," as per the requirements."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Query\xa0{\ngroovyFind(type: String!,  arcql: String!,  first: Int,  after: String,  last: Int,  before: String,  includeTrashed: Boolean,  page: Int):Json @tan(type:Groovy,  inline:  """return find(type, arcql, first, after, last, before, includeTrashed, page)""")  \n}\n')),Object(o.b)("p",null,"Let's retrieve the data inserted in the Author object."),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  groovyFind(type:"Author", arcql:"hypi.id = \'01F9V5QJDFV5MJWSQ0KV13N5PN\'")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyFind": {\n      "edges": [\n        {\n          "cursor": "01F9V5QJDFV5MJWSQ0KV13N5PN",\n          "node": {\n            "__typename": "Author",\n            "hypi": {\n              "__typename": "Hypi",\n              "id": "01F9V5QJDFV5MJWSQ0KV13N5PN",\n              "impl": null,\n              "created": "2021-07-05T11:09:24Z",\n              "updated": "2021-07-05T11:18:26Z",\n              "trashed": null,\n              "createdBy": "01F2GA50NFXHMYCBDNYFJK1V7R",\n              "instanceId": "01F9V52Z4NW0CBTNS7QG7G3RAE",\n              "tags": null\n            },\n            "name": "Dan Brown",\n            "age": 56,\n            "count": 3,\n            "booklist": [\n              {\n                "__typename": "Book",\n                "hypi": {\n                  "__typename": "Hypi",\n                  "id": "01F9V5QJDJCNF8EENSAQNXC217",\n                  "impl": null,\n                  "created": "2021-07-05T11:09:24Z",\n                  "updated": "2021-07-05T11:09:24Z",\n                  "trashed": null,\n                  "createdBy": "01F2GA50NFXHMYCBDNYFJK1V7R",\n                  "instanceId": "01F9V52Z4NW0CBTNS7QG7G3RAE",\n                  "tags": null\n                },\n                "title": "Da Vinci Code",\n                "publication": "abc",\n                "available": true\n              },\n              {\n                "__typename": "Book",\n                "hypi": {\n                  "__typename": "Hypi",\n                  "id": "01F9V68331S0PVGH1Y8QK39NPC",\n                  "impl": null,\n                  "created": "2021-07-05T11:18:26Z",\n                  "updated": "2021-07-05T11:18:26Z",\n                  "trashed": null,\n                  "createdBy": "01F2GA50NFXHMYCBDNYFJK1V7R",\n                  "instanceId": "01F9V52Z4NW0CBTNS7QG7G3RAE",\n                  "tags": null\n                },\n                "title": "Inferno",\n                "publication": "xyz",\n                "available": true\n              }\n            ]\n          }\n        }\n      ]\n    }\n  }\n}\n')))),Object(o.b)("h3",{id:"get"},"get"),Object(o.b)("p",null,"Below ",Object(o.b)("inlineCode",{parentName:"p"},"groovyGet")," user defined function can be used to get data from a single object.  Its behaviour is the same as the ",Object(o.b)("a",{parentName:"p",href:"/docs/read-data#get"},"get")," function from CRUD APIs.  You may choose another name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyGe")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Query\xa0{\ngroovyGet( type: HypiMutationType! id: String! ): HypiRootAggregate\n  @tan(type:Groovy, inline: """return get(type, id)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  groovyGet(type:Author, id:"01F9V5QJDFV5MJWSQ0KV13N5PN") {\n    ... on Author {\n      hypi{\n        id\n        created\n        updated\n      }\n      name\n      booklist{\n        title\n        available\n      }\n    }\n  }\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyGet": {\n      "hypi": {\n        "id": "01F9V5QJDFV5MJWSQ0KV13N5PN",\n        "created": "2021-07-05T11:09:24Z",\n        "updated": "2021-07-05T11:18:26Z"\n      },\n      "name": "Dan Brown",\n      "booklist": [\n        {\n          "title": "Da Vinci Code",\n          "available": true\n        },\n        {\n          "title": "Inferno",\n          "available": true\n        }\n      ]\n    }\n  }\n}\n')))),Object(o.b)("h3",{id:"trash"},"trash"),Object(o.b)("p",null,"Below ",Object(o.b)("inlineCode",{parentName:"p"},"groovyTrash")," user defined function can be used to put unwanted data in a trash.  Its behaviour is the same as the ",Object(o.b)("a",{parentName:"p",href:"/docs/delete-data#trash"},"trash")," function from CRUD APIs. You may choose another name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyTrash")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation\xa0{\ngroovyTrash( type: HypiMutationType! arcql: String! ): Int!\n  @tan(type:Groovy, inline: """return trash(type, arcql)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"mutation {\n  groovyTrash(type:Author,arcql: \"hypi.id='01F9V5QJDFV5MJWSQ0KV13N5PN'\")\n}\n"))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyTrash": 1\n  }\n}\n')))),Object(o.b)("h3",{id:"untrash"},"untrash"),Object(o.b)("p",null,"Below user defined function (",Object(o.b)("inlineCode",{parentName:"p"},"groovyUntrash"),")  can be used to put unwanted data in a trash.  Its behaviour is the same as the ",Object(o.b)("a",{parentName:"p",href:"/docs/delete-data#untrash"},"untrash")," function from CRUD APIs. You may use different name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUntrash")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation\xa0{\ngroovyUntrash( type: HypiMutationType! arcql: String! ): Int!\n  @tan(type:Groovy, inline: """return untrash(type, arcql)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"mutation {\n  groovyUntrash(type:Author,arcql: \"hypi.id='01F9V5QJDFV5MJWSQ0KV13N5PN'\")\n}\n"))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyUntrash": 1\n  }\n}\n')))),Object(o.b)("h3",{id:"delete"},"delete"),Object(o.b)("p",null,"Look at the ",Object(o.b)("inlineCode",{parentName:"p"},"groovyDelete")," user defined function below. It can be used to delete the unwanted data permanently  Its behaviour is the same as the ",Object(o.b)("a",{parentName:"p",href:"/docs/delete-data#delete"},"delete")," function from CRUD APIs. You may use another name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyDelete")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation {\n  groovyDelete(type: HypiMutationType! arcql: String! clearArrayReferences: Boolean = false ): Int!\n  @tan(type:Groovy, inline: """return delete(type, arcql, clearArrayReferences)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},"\nmutation {\n  groovyDelete(type: Book, arcql: \"hypi.id = '01F9V68331S0PVGH1Y8QK39NPC'\",\n  clearArrayReferences:true)\n}\n"))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyDelete": 1\n  }\n}\n')))),Object(o.b)("h3",{id:"deletescalars"},"deleteScalars"),Object(o.b)("p",null,"Data in a square array can be permanently deleted as shown in the ",Object(o.b)("inlineCode",{parentName:"p"},"groovyDeleteScalars")," user defined function below. Behaviour is the same as that of ",Object(o.b)("a",{parentName:"p",href:"/docs/delete-data#deletescalars"},"deleteScalars"),".  You may choose appropriate name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyDeleteScalars")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation { \n groovyDeleteScalars( type: HypiMutationType! field: String! values: [String!]! arcql: String! ): Int!\n  @tan(type:Groovy, inline: """return deleteScalars(type, field, values, arcql)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation{\n  groovyDeleteScalars(\n    type:Question,\n    field:"answer",\n    values:["a","b"],\n    arcql:"hypi.id =\'01F9VASEMCNFMR7F8N13R6GJXS\'"\n  )\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyDeleteScalars": 2\n  }\n}\n')))),Object(o.b)("h3",{id:"link"},"link"),Object(o.b)("p",null,"You can create a reference, using the ",Object(o.b)("inlineCode",{parentName:"p"},"link")," function. Two objects can be conneted using one-to-one or one-to-many references.  ",Object(o.b)("inlineCode",{parentName:"p"},"groovyLink")," function below works similar to the ",Object(o.b)("a",{parentName:"p",href:"/docs/references"},"link")," function. You may replace ",Object(o.b)("inlineCode",{parentName:"p"},"groovyLink"),"  with another function name."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation {\ngroovyLink( from: HypiMutationType! to: HypiMutationType! via: String! whereFromID: String! andToID: String! fromInstanceId: String toInstanceId: String ): Boolean!\n  @tan(type:Groovy, inline: """return link(from, to, via, whereFromID, andToID, fromInstanceId, toInstanceId)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation {\n    groovyLink(from:Author,to:Book,    via:"booklist",whereFromID:"01F9V5QJDFV5MJWSQ0KV13N5PN",andToID:"01F9VB3EJMQWF27JW6QKPBEGM2")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyLink": true\n  }\n}\n')))),Object(o.b)("h3",{id:"unlink"},"unlink"),Object(o.b)("p",null,"You can remove a reference, using the unlink function.  ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUnlink")," user defined function below works similar to the ",Object(o.b)("a",{parentName:"p",href:"/docs/references"},"unlink")," function.  You may opt to have another name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUnlink")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation {\ngroovyUnlink(from: HypiMutationType! to: HypiMutationType! via: String! whereFromID: String! andToID: String! fromInstanceId: String toInstanceId: String ): Boolean!\n  @tan(type:Groovy, inline: """return unlink(from, to, via, whereFromID, andToID, fromInstanceId, toInstanceId)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation {  groovyUnlink(from:Author,to:Book,via:"booklist",whereFromID:"01F9V5QJDFV5MJWSQ0KV13N5PN",andToID:"01F9VB3EJMQWF27JW6QKPBEGM2")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyUnlink": true\n  }\n}\n')))),Object(o.b)("h3",{id:"createaccount"},"createAccount"),Object(o.b)("p",null,"You may create a new user account using createAccount. The ",Object(o.b)("inlineCode",{parentName:"p"},"groovyCreateAccount")," user defined function works similar to the ",Object(o.b)("a",{parentName:"p",href:"/docs/authentication#createaccount"},"createAccount")," function. Here is the schema."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation {\ngroovyCreateAccount( value: AccountInput! ): Hypi\n  @tan(type:Groovy, inline: """return createAccount(value)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation {\n groovyCreateAccount(\n     value: {\n         username: "test-hypi1@hypi.io"\n         password: { value: "test-hypi1@hypi.io" }\n         emails: [{ value: "test-hypi1@hypi.io" }]\n     }\n     ) {\n         id\n         created\n         createdBy\n     }\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyCreateAccount": {\n      "id": "01F9V9JVG571TCQ11KSM7Y5PR5",\n      "created": "2021-07-05T12:16:44Z",\n      "createdBy": "01F9V9JVG571TCQ11KSM7Y5PR5"\n    }\n  }\n}\n')))),Object(o.b)("h3",{id:"login--loginbyemail"},"login / loginByEmail"),Object(o.b)("p",null,"Users may login with ",Object(o.b)("inlineCode",{parentName:"p"},"login")," or  ",Object(o.b)("inlineCode",{parentName:"p"},"loginByEmail")," function. ",Object(o.b)("inlineCode",{parentName:"p"},"groovyLogin")," /",Object(o.b)("inlineCode",{parentName:"p"},"groovyLoginByEmail"),"  user defined functions below work similar to ",Object(o.b)("a",{parentName:"p",href:"/docs/authentication#login"},"login")," / ",Object(o.b)("a",{parentName:"p",href:"/docs/authentication#loginbyemail"},"loginByEmail")," functions. You may choose another names for these functions."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Query {\ngroovyLoginByEmail(email: String! password: String! ): AccessToken\n  @tan(type:Groovy, inline: """return loginByEmail(email, password)""")\n \n groovyLogin(username: String! password: String! ): AccessToken\n  @tan(type:Groovy, inline: """return login(username, password)""")\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  groovyLogin(username:"test-hypi@hypi.io",password:"test-hypi@hypi.io"){\n        sessionToken\n        sessionExpires\n        errorCode\n        errorMsg\n    }\n}\nOR\n{\n  groovyLoginByEmail(email:"test-hypi@hypi.io",password:"test-hypi@hypi.io"){\n        sessionToken\n        sessionExpires\n        errorCode\n        errorMsg\n    }\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyLogin": {\n      "sessionToken": "Auth-Token",\n      "sessionExpires": 1628078182,\n      "errorCode": null,\n      "errorMsg": null\n    }\n  }\n}\n')))),Object(o.b)("h3",{id:"maths-apis"},"Maths APIs"),Object(o.b)("p",null,"Maths APIs can be used to perform Mathematical operations. Behaviour of ",Object(o.b)("inlineCode",{parentName:"p"},"groovyMath")," user defined function is similar to ",Object(o.b)("a",{parentName:"p",href:"/docs/maths-api"},"Maths APIs"),". "),Object(o.b)("p",null,"Here is the schema. Please note the use of square brackets in the syntax. ",Object(o.b)("inlineCode",{parentName:"p"},"price")," is the float field on which Mathematical operations are carried out. You may have another name for ",Object(o.b)("inlineCode",{parentName:"p"},"groovyMath")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'type Mutation {\ngroovyMath(a: ID, b: Float, c: Float, d: Float, e:Float):Json\n  @tan(type:Groovy, inline: """return math([\n          Book: [\n            [             \n                price: [\n                 hypi: [\n                  id: a\n                 ],\n                 div: b,\n                 times: c,\n                 minus: d,\n                 plus: e\n                ]             \n             ] \n          ]\n       ]\n    )  \n  """\n  )\n}\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'mutation{\n  groovyMath(a:"01F9VCE833595FYZR9X6MSKPMH",b:10,c:2,d:2,e:8)\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyMath": [\n      {\n        "__typename": "Hypi",\n        "id": "01F9VCE833595FYZR9X6MSKPMH",\n        "impl": null,\n        "created": null,\n        "updated": "2021-07-05T13:08:58Z",\n        "trashed": null,\n        "createdBy": null,\n        "instanceId": "01F9V52Z4NW0CBTNS7QG7G3RAE",\n        "tags": null\n      }\n    ]\n  }\n}\n')))),Object(o.b)("h3",{id:"parsejson"},"parseJSON"),Object(o.b)("p",null,"You may parse a JSON value inside a user defined function using ",Object(o.b)("inlineCode",{parentName:"p"},"parseJSON")," function. ",Object(o.b)("inlineCode",{parentName:"p"},"groovyParseJSON")," function below does the same.  "),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'groovyParseJSON(value: String): Json\n  @tan(type:Groovy, inline: """return parseJSON(value)""")\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  groovyParseJSON(value:"{\\"share\\":{\\"gpname\\": \\"scalars\\",\\"url\\": \\"scalars@hypi.in\\"}}")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyParseJSON": {\n      "share": {\n        "gpname": "scalars",\n        "url": "scalars@hypi.in"\n      }\n    }\n  }\n}\n')))),Object(o.b)("h3",{id:"parsexml"},"parseXML"),Object(o.b)("p",null,"You may parse an XML value inside a user defined function using ",Object(o.b)("inlineCode",{parentName:"p"},"parseXML")," function. ",Object(o.b)("inlineCode",{parentName:"p"},"groovyParseXML")," function below does the same.  "),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'groovyParseXML(value: String): Json\n  @tan(type:Groovy, inline: """return parseXML(value)""")\n')),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  groovyParseXML(value:"<note><to>abc</to><from>xyz</from><heading>Reminder</heading><body>Low code</body></note>")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "data": {\n    "groovyParseXML": {\n      "to": "abc",\n      "from": "xyz",\n      "heading": "Reminder",\n      "body": "Low code"\n    }\n  }\n}\n')))),Object(o.b)("h3",{id:"function-gql"},"Function \u2018gql\u2019"),Object(o.b)("p",null,"The function 'gql' is available to execute inside the user defined function. Using this function you may perform mutation or query operations inside the usergraphql defined function. The result depends upon the type of operation. If you perform an ",Object(o.b)("inlineCode",{parentName:"p"},"upsert")," mutation, it will return id, createdBy etc. (Just like the normal ",Object(o.b)("inlineCode",{parentName:"p"},"upsert")," in Hypi) If you perform a ",Object(o.b)("inlineCode",{parentName:"p"},"find")," query, it will return a list.  ",Object(o.b)("inlineCode",{parentName:"p"},"groovyUpsert")," can be defined in the schema under Mutation type as follows."),Object(o.b)("p",null,"Let\u2019s check a few examples of how to use this function. Add the following schema in GraphQL."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'type Mutation {\n  SetBookInfo(a: String, b: Float, c: Int):Json @tan(type:Groovy, inline: """\n    return [ gql(\\"""\n    mutation {\n        upsert(\n            values: { \n                Book: [\n                    { \n                        title: "$a",\n                        price: $b,\n                        authorid: $c\n                    }\n                ] \n            }\n        ) {\n            id\n        }\n    }\\"""\n    )\n    ]\n  """)\n}\ntype Query {\n  GetAuthorInfo(a: String):Json @tan(type:Groovy, inline: """\n    return [ gql(\\"""\n    query {\n           get(type: Author, id: "$a"){\n            ... on Author {\n            hypi{\n                id               \n            }\n            name\n            booklist{\n                title               \n                price\n                authorid \n            }\n        }\n        \n    }\n    }\\"""\n    )\n    ]\n  """)\n}                                                         \n')),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"SetBookInfo")," is a user defined function to set parameter values inside the table ",Object(o.b)("inlineCode",{parentName:"p"},"Book"),". Upon successful creation of the object, the ",Object(o.b)("inlineCode",{parentName:"p"},"hypi.id")," is returned."),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'mutation {\n  SetBookInfo(a:"Ikigai", b:6.99, c: 7)\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'{\n  "data": {\n    "SetBookInfo": [\n      {\n        "data": {\n          "upsert": [\n            {\n              "id": "01F1F23WERW6V4JQYDRW4QQRBQ"\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n')))),Object(o.b)("p",null,"Let's retrieve ",Object(o.b)("inlineCode",{parentName:"p"},"Author")," table data using ",Object(o.b)("inlineCode",{parentName:"p"},"GetAthorInfo"),". Pass the Author id as ",Object(o.b)("inlineCode",{parentName:"p"},"Author1")," .It returns the author infomation with id 'Author1'"),Object(o.b)(i.a,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"query",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'query {\n  GetAuthorInfo(a:"Author1")\n}\n'))),Object(o.b)(l.a,{value:"response",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "GetAuthorInfo": [\n      {\n        "data": {\n          "get": {\n            "hypi": {\n              "id": "Author1"\n            },\n            "name": "Dan Brown",\n            "booklist": [\n              {\n                "title": "Da Vinci Code",\n                "price": 12.99,\n                "authorid": 1\n              }\n            ]\n          }\n        }\n      }\n    ]\n  }\n}\n')))),Object(o.b)("p",null,"The",Object(o.b)("inlineCode",{parentName:"p"},"gql"),"function accepts two parameters."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"query"),": String - the GraphQL query to execute"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"values"),": Map - a map containing the set of variables used in ",Object(o.b)("inlineCode",{parentName:"li"},"query"))),Object(o.b)("p",null,"In the above examples, we have just used GraphQL query string. Let's modify the ",Object(o.b)("inlineCode",{parentName:"p"},"SetBookInfo")," function with Map values."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"type Mutation {\n  SetBookInfo(a: String, b: Float, c: Int):Json @tan(type:Groovy, inline: \"\"\"\n    return gql('''\n    mutation CreateBook($p: String, $q: Float, $r: Int){\n        upsert(\n            values: { \n                Book: [\n                    { \n                        title: $p,\n                        price: $q,\n                        authorid: $r\n                    }\n                ] \n            }\n        ) {\n            id\n        }\n    }''', ['p':a , 'q': b, 'r': c])\n  \"\"\")\n}\n")),Object(o.b)("p",null,"Notice few changes here:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Replaced the ",Object(o.b)("inlineCode",{parentName:"li"},'\\"""')," with just ",Object(o.b)("inlineCode",{parentName:"li"},"'''")," . Using three ",Object(o.b)("inlineCode",{parentName:"li"},"'")," in Groovy, we have the same effect as ",Object(o.b)("inlineCode",{parentName:"li"},'"""'),". without string interpolation. It means that ",Object(o.b)("inlineCode",{parentName:"li"},"$a")," is not evaluated as a Groovy variable and remains as a part of the string."),Object(o.b)("li",{parentName:"ul"},"Added GraphQL variables ",Object(o.b)("inlineCode",{parentName:"li"},"CreateBook($p: String, $q: Float, $r: Int)")),Object(o.b)("li",{parentName:"ul"},"Added variable values ",Object(o.b)("inlineCode",{parentName:"li"},"['p':a, 'q': b, 'r': c]")," in the map. Now, the variables ",Object(o.b)("inlineCode",{parentName:"li"},"$p")," , ",Object(o.b)("inlineCode",{parentName:"li"},"$q")," and ",Object(o.b)("inlineCode",{parentName:"li"},"$r")," are GraphQL variables not Groovy variables.")),Object(o.b)("p",null,"With these changes, the result is the same as the previous example!"))}p.isMDXComponent=!0}}]);