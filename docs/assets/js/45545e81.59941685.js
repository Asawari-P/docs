(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9496],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return g},kt:function(){return d}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=a.createContext({}),s=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},g=function(e){var n=s(e.components);return a.createElement(u.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),c=s(t),d=r,m=c["".concat(u,".").concat(d)]||c[d]||p[d]||o;return t?a.createElement(m,i(i({ref:n},g),{},{components:t})):a.createElement(m,i({ref:n},g))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=c;var l={};for(var u in n)hasOwnProperty.call(n,u)&&(l[u]=n[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},8215:function(e,n,t){"use strict";var a=t(7294);n.Z=function(e){var n=e.children,t=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},5064:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var a=t(7294),r=t(9443);var o=function(){var e=(0,a.useContext)(r.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},i=t(6010),l="tabItem_1uMI",u="tabItemActive_2DSg";var s=37,g=39;var p=function(e){var n=e.lazy,t=e.block,r=e.defaultValue,p=e.values,c=e.groupId,d=e.className,m=o(),h=m.tabGroupChoices,f=m.setTabGroupChoices,y=(0,a.useState)(r),v=y[0],k=y[1],b=a.Children.toArray(e.children),w=[];if(null!=c){var N=h[c];null!=N&&N!==v&&p.some((function(e){return e.value===N}))&&k(N)}var T=function(e){var n=e.currentTarget,t=w.indexOf(n),a=p[t].value;k(a),null!=c&&(f(c,a),setTimeout((function(){var e,t,a,r,o,i,l,s;(e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.bottom,o=e.right,i=window,l=i.innerHeight,s=i.innerWidth,t>=0&&o<=s&&r<=l&&a>=0)||(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add(u),setTimeout((function(){return n.classList.remove(u)}),2e3))}),150))},x=function(e){var n,t;switch(e.keyCode){case g:var a=w.indexOf(e.target)+1;t=w[a]||w[0];break;case s:var r=w.indexOf(e.target)-1;t=w[r]||w[w.length-1]}null==(n=t)||n.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":t},d)},p.map((function(e){var n=e.value,t=e.label;return a.createElement("li",{role:"tab",tabIndex:v===n?0:-1,"aria-selected":v===n,className:(0,i.Z)("tabs__item",l,{"tabs__item--active":v===n}),key:n,ref:function(e){return w.push(e)},onKeyDown:x,onFocus:T,onClick:T},t)}))),n?(0,a.cloneElement)(b.filter((function(e){return e.props.value===v}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},b.map((function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==v})}))))}},9443:function(e,n,t){"use strict";var a=(0,t(7294).createContext)(void 0);n.Z=a},3113:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return g},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var a=t(2122),r=t(9756),o=(t(7294),t(3905)),i=t(5064),l=t(8215),u=["components"],s={id:"aggregation",title:"Aggregation",sidebar_label:"Aggregation",slug:"/aggregation"},g=void 0,p={unversionedId:"aggregation",id:"aggregation",isDocsHomePage:!1,title:"Aggregation",description:"Aggregation performs a calculation on a set of values and returns a single value. Aggregations are powerful functions. Their results provide insight into the gathered values in the database.",source:"@site/content/aggregation.md",sourceDirName:".",slug:"/aggregation",permalink:"/docs/aggregation",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/aggregation.md",version:"current",frontMatter:{id:"aggregation",title:"Aggregation",sidebar_label:"Aggregation",slug:"/aggregation"},sidebar:"docs",previous:{title:"API gateway",permalink:"/docs/apigateway"},next:{title:"Maths APIs",permalink:"/docs/maths-api"}},c=[{value:"Examples:",id:"examples",children:[{value:"Aggregate with No Filter",id:"aggregate-with-no-filter",children:[]},{value:"Aggregate Distinct Rows",id:"aggregate-distinct-rows",children:[]},{value:"Aggregate Matching Rows",id:"aggregate-matching-rows",children:[]},{value:"Aggregate with groupBy",id:"aggregate-with-groupby",children:[]},{value:"Aggregate by Date",id:"aggregate-by-date",children:[]}]}],d={toc:c};function m(e){var n=e.components,t=(0,r.Z)(e,u);return(0,o.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Aggregation performs a calculation on a set of values and returns a single value. Aggregations are powerful functions. Their results provide insight into the gathered values in the database."),(0,o.kt)("p",null,"You can aggregate any scalar field in at least one way. String fields can only be counted or grouped. But, you can perform aggregations on numerical fields like Integers and Floats. You can perform the following aggregations with Hypi."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"avg"),"\xa0- Calculates the average of a set of values from a field"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"count"),"\xa0- Counts the number of records from a field"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"sum"),"\xa0\u2013 Calculates the sum of a set of values from a field"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"max"),"\xa0\u2013 Returns maximum from a set of values"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"min"),"\xa0\u2013 Returns minimum from a set of values")),(0,o.kt)("p",null,"We will use the following schema to work with aggregate functions."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"type Book {\n    authorid:\xa0Int\n    title:\xa0String\n    price:\xa0Float\n}\n\ntype Author\xa0{\n    name:\xa0String\n    age:\xa0Int\n    booklist:\xa0[Book!]\n}\n")),(0,o.kt)("h2",{id:"examples"},"Examples:"),(0,o.kt)("p",null,"Let\u2019s add some data in an object to perform aggregations."),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Input Data",value:"data"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"mutation Upsert($values: HypiUpsertInputUnion!) {\n    upsert(values: $values) {\n    id\n    }\n}\n"))),(0,o.kt)(l.Z,{value:"data",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "values": {\n "Author": [\n     {\n     "hypi": {"id": "Author1"},\n     "name": "Dan Brown",\n     "age": 56,\n     "booklist":[\n         {\n         "hypi": {"id": "Author1Book1"},\n         "title": "Da Vinci Code",\n         "price": 12.99,\n         "authorid": 1\n         },\n         {\n         "hypi": {"id": "Author1Book2"},\n         "title": "The Last Symbol",\n         "price": 10,\n         "authorid": 1\n         },\n         {\n         "hypi": {"id": "Author1Book3"},\n         "title": "Inferno",\n         "price": 5.99,\n         "authorid": 1\n         }\n         ]\n     },\n {\n     "hypi": {"id": "Author2"},\n     "name": "Paulo Coelho",\n     "age": 70,\n     "booklist":[\n         {\n         "hypi": {"id": "Author2Book1"},\n         "title": "Alchemist",\n         "price": 5.99,\n         "authorid": 2\n         },\n        {\n         "hypi": {"id": "Author2Book2"},\n         "title": "Warriors of light",\n         "price": 12.99,\n         "authorid": 2\n         }\n         ]\n     }\n   ]\n }\n}\n'))),(0,o.kt)(l.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n     "data": {\n     "upsert": [\n         {\n         "id": "Author1"\n         },\n         {\n         "id": "Author2"\n         }\n        ]\n    }\n}\n')))),(0,o.kt)("p",null,"Here author\u2019s age and price of the book are numerical fields. So, we would perform operations on these two fields. Aggregation operations can be performed with or without filters. Filters may have ",(0,o.kt)("inlineCode",{parentName:"p"},"distinct"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"group-by")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"where")," clauses, etc. They are similar to SQL-type database queries."),(0,o.kt)("h3",{id:"aggregate-with-no-filter"},"Aggregate with No Filter"),(0,o.kt)("p",null,"The below example demonstrates aggregation without any filters. Here, we are simply aggregating values from age and price fields. The function returns the average value, the number of records(count), minimum value, maximum value, and the sum of the values from both fields."),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"{\n  aggregate {\n    author {\n      age {\n        avg\n        count\n        max\n        min\n        sum\n      }\n    }\n    book {\n      price {\n        avg\n        count\n        max\n        min\n        sum\n      }\n    }\n  }\n}\n"))),(0,o.kt)(l.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n     "aggregate": {\n         "author": {\n             "age": {\n             "avg": 63,\n             "count": 2,\n             "max": 70,\n             "min": 56,\n             "sum": 126\n         }\n     },\n         "book": {\n             "price": {\n             "avg": 9.592000000000002,\n             "count": 5,\n             "max": 12.99,\n             "min": 5.99,\n             "sum": 47.96000000000001\n             }\n         }\n      }\n   }\n}\n')))),(0,o.kt)("p",null,"You may not select a field or an aggregation function, if it's not needed, Hypi will perform calculations only if you select the field or specify the aggregate function. This means you get faster queries by specifying less."),(0,o.kt)("h3",{id:"aggregate-distinct-rows"},"Aggregate Distinct Rows"),(0,o.kt)("p",null,"You may aggregate unique rows by specifying the filter \u2018distinct\u2019 as true. Hypi considers repeated values as just one value. Hence, the count of books has gone down to 3. Only three unique prices have been selected for aggregation. (12.99,5.99,10)"),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"{\n  aggregate {\n    book {\n      price {\n        avg(distinct: true)\n        count(distinct: true)\n        sum(distinct: true)\n      }\n    }\n  }\n}\n"))),(0,o.kt)(l.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n     "aggregate": {\n         "book": {\n             "price": {\n             "avg": 9.660000000000002,\n             "count": 3,\n             "sum": 28.980000000000004\n             }\n         }\n     }\n   }\n}\n')))),(0,o.kt)("h3",{id:"aggregate-matching-rows"},"Aggregate Matching Rows"),(0,o.kt)("p",null,"You may select matching rows ( records with the specific field value) and perform aggregation on those rows. The below example shows the aggregation of prices of books with ",(0,o.kt)("inlineCode",{parentName:"p"},"authorid")," equal to \u20182\u2019.",(0,o.kt)("inlineCode",{parentName:"p"},"where")," clause have been used for row selection. The result returns aggregate values of prices of books of the second author.,i.e. Paulo Coelho"),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"{\n  aggregate {\n    book(where: \"authorid='2'\") {\n      price {\n        avg\n        count\n        sum\n      }\n    }\n  }\n}\n"))),(0,o.kt)(l.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n     "aggregate": {\n         "book": {\n             "price": {\n                 "avg": 9.49,\n                 "count": 2,\n                 "sum": 18.98\n                 }\n             }\n         }\n     }\n}\n')))),(0,o.kt)("h3",{id:"aggregate-with-groupby"},"Aggregate with groupBy"),(0,o.kt)("p",null,"You may make specific groups of records and perform aggregate operations on them. Use ",(0,o.kt)("inlineCode",{parentName:"p"},"groupBy")," clause as a filter. The below example makes two groups by specifying ",(0,o.kt)("inlineCode",{parentName:"p"},"authorid")," as groupBy field. There are two groups of books with 2 distinct authorids. So, authorid is a key with values 1 and 2. ",(0,o.kt)("inlineCode",{parentName:"p"},"groupValues")," povide the key (groupBy field) and the value of the key."),(0,o.kt)("p",null,"\u2018With\u2019 gets attached to the data type to form the aggregate query function. Use the function ",(0,o.kt)("inlineCode",{parentName:"p"},"bookWith")," for using the groupby clause. (Here data type is ",(0,o.kt)("inlineCode",{parentName:"p"},"book"),"). You may specify the order to sort the key values,i.e. ascending or descending. (ASC/DESC). The ",(0,o.kt)("inlineCode",{parentName:"p"},"bookWith")," function returns the aggregate prices of books of two authors."),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"{\n aggregate {\n     bookWith(groupBy: [{ field: authorid, order: DESC }]) {\n         price {\n             avg\n             count\n             sum\n             groupValues {\n                 key\n                 value\n             }\n         }\n      }\n   }\n}\n"))),(0,o.kt)(l.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n "aggregate": {\n "bookWith": [\n     {\n         "price": {\n             "avg": 9.49,\n             "count": 2,\n             "sum": 18.98,\n             "groupValues": [\n                 {\n                 "key": "authorid",\n                 "value": "2"\n                 }\n              ]\n           }\n     },\n     {\n     "price": {\n         "avg": 9.660000000000002,\n         "count": 3,\n         "sum": 28.980000000000004,\n         "groupValues": [\n             {\n             "key": "authorid",\n             "value": "1"\n             }\n           ]\n         }\n       }\n     ]\n    }\n  }\n}\n')))),(0,o.kt)("h3",{id:"aggregate-by-date"},"Aggregate by Date"),(0,o.kt)("p",null,"You may group the fields based upon the ",(0,o.kt)("inlineCode",{parentName:"p"},"dateTime")," field. Hypi object has the dateTime fields like ",(0,o.kt)("inlineCode",{parentName:"p"},"hypi_created")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"hypi_updated"),". The below example has groups based upon the date of creation of objects. dateGranularity can be set to DAYS, HOURS, MINUTES, or SECONDS."),(0,o.kt)(i.Z,{defaultValue:"query",values:[{label:"GraphQL Query",value:"query"},{label:"Response",value:"response"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"query",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"{\n  aggregate {\n    bookWith(groupBy: [{ field: hypi_created, dateGranularity: MINUTES }]) {\n      price {\n        avg\n        count\n        sum\n        groupValues {\n          key\n          value\n        }\n      }\n    }\n  }\n}\n"))),(0,o.kt)(l.Z,{value:"response",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n "data": {\n "aggregate": {\n     "bookWith": [\n         {\n             "price": {\n                 "avg": 2.99,\n                 "count": 1,\n                 "sum": 2.99,\n                 "groupValues":[\n                     {\n                     "key": "hypi_created",\n                     "value": "2021-03-15 10:52"\n                     }\n                 ]\n             }\n         },\n         {\n             "price": {\n                 "avg": 9.592000000000002,\n                 "count": 5,\n                 "sum": 47.96000000000001,\n                 "groupValues": [\n                     {\n                     "key": "hypi_created",\n                     "value": "2021-03-15 10:39"\n                     }\n                 ]\n             }\n          }\n       ]\n    }\n  }\n}\n')))),(0,o.kt)("p",null,"You can know more about dateGranularity in ",(0,o.kt)("a",{parentName:"p",href:"/docs/time-series-aggregations"},"this")," tutorial."))}m.isMDXComponent=!0},6010:function(e,n,t){"use strict";function a(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=a(e[n]))&&(r&&(r+=" "),r+=t);else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function r(){for(var e,n,t=0,r="";t<arguments.length;)(e=arguments[t++])&&(n=a(e))&&(r&&(r+=" "),r+=n);return r}t.d(n,{Z:function(){return r}})}}]);