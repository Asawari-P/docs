(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{100:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return o})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return c}));var a=n(3),r=n(8),l=(n(0),n(159)),i={id:"fileupload",title:"File Upload",sidebar_label:"File Upload",slug:"/fileupload"},o={unversionedId:"fileupload",id:"fileupload",isDocsHomePage:!1,title:"File Upload",description:"Many applications need to upload the file to the backend. Hypi provides a simple API to do so!",source:"@site/content/fileupload.md",slug:"/fileupload",permalink:"/docs/fileupload",editUrl:"https://github.com/hypi-universe/docs/edit/master/content/fileupload.md",version:"current",sidebar_label:"File Upload",sidebar:"docs",previous:{title:"Serverless Function",permalink:"/docs/serverlessfunction"},next:{title:"RESTful APIs",permalink:"/docs/rest-apis"}},p=[{value:"Upload endpoint",id:"upload-endpoint",children:[]},{value:"Download endpoint",id:"download-endpoint",children:[]},{value:"curl upload example",id:"curl-upload-example",children:[]},{value:"curl download example",id:"curl-download-example",children:[]}],b={toc:p};function c(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"Many applications need to upload the file to the backend. Hypi provides a simple API to do so!"),Object(l.b)("p",null,"Hypi\u2019s core App has a type definition called ",Object(l.b)("inlineCode",{parentName:"p"},"File"),". A file can be uploaded using an endpoint. Once it is uploaded an object of ",Object(l.b)("inlineCode",{parentName:"p"},"File")," type gets created. The information about the file gets extracted and stored as a ",Object(l.b)("inlineCode",{parentName:"p"},"File")," object. The definition includes metadata about the file, the URL to download it, and more."),Object(l.b)("p",null,"The file can be downloaded from the URL given in the object using an authorization token. Anonymous users cannot download the file. To permit access to other users can be granted to download the file."),Object(l.b)("p",null,"With this preliminary information, let\u2019s get inside the ",Object(l.b)("inlineCode",{parentName:"p"},"File")," type definition."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},"type File\xa0{\n    name:\xa0String!\n    directory:\xa0String!\n    path:\xa0String!\n    isDirectory:\xa0Boolean!\n    status:\xa0FileStatus\n    url:\xa0URL\n    type:\xa0String\n    size:\xa0Long\n    extension:\xa0String\n    isStared:\xa0Boolean\n    isSharable:\xa0Boolean\n    content:\xa0String\n    children(...):\xa0[File!]\n}\n")),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"th"},"Parameter")),Object(l.b)("th",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"th"},"Type")),Object(l.b)("th",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"th"},"Description")))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"name")),Object(l.b)("td",{parentName:"tr",align:null},"String"),Object(l.b)("td",{parentName:"tr",align:null},"Name of the file")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"directory")),Object(l.b)("td",{parentName:"tr",align:null},"String"),Object(l.b)("td",{parentName:"tr",align:null},"The name of the directory")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"path")),Object(l.b)("td",{parentName:"tr",align:null},"String"),Object(l.b)("td",{parentName:"tr",align:null},"The path of the file")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"isDirectory")),Object(l.b)("td",{parentName:"tr",align:null},"Boolean"),Object(l.b)("td",{parentName:"tr",align:null},"If the file has to be uploaded in a virtual file system like Google Drive/Dropbox, this field is set to true")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"status")),Object(l.b)("td",{parentName:"tr",align:null},"FileStatus"),Object(l.b)("td",{parentName:"tr",align:null},"Status of file upload")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"url")),Object(l.b)("td",{parentName:"tr",align:null},"URL"),Object(l.b)("td",{parentName:"tr",align:null},"URL to download file")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"type")),Object(l.b)("td",{parentName:"tr",align:null},"String"),Object(l.b)("td",{parentName:"tr",align:null},"Media type")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"size")),Object(l.b)("td",{parentName:"tr",align:null},"Long"),Object(l.b)("td",{parentName:"tr",align:null},"Size of the file in Bytes")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"extension")),Object(l.b)("td",{parentName:"tr",align:null},"String"),Object(l.b)("td",{parentName:"tr",align:null},"Extension of the file (.txt,.jpg, etc)")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"isStared")),Object(l.b)("td",{parentName:"tr",align:null},"Boolean"),Object(l.b)("td",{parentName:"tr",align:null},"For the virtual file system, the file can be set to Starred status")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"isSharable")),Object(l.b)("td",{parentName:"tr",align:null},"Boolean"),Object(l.b)("td",{parentName:"tr",align:null},"File sharing status")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"content")),Object(l.b)("td",{parentName:"tr",align:null},"String"),Object(l.b)("td",{parentName:"tr",align:null},"For the virtual file system upload, the content of the file would be set to a String value. Otherwise, the content would be null.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},Object(l.b)("strong",{parentName:"td"},"children")),Object(l.b)("td",{parentName:"tr",align:null},"File"),Object(l.b)("td",{parentName:"tr",align:null},"For the virtual file system, the directory can have sub-files")))),Object(l.b)("h3",{id:"upload-endpoint"},"Upload endpoint"),Object(l.b)("p",null,"To upload a file (any file can be uploaded, image, pdf, etc), use the following endpoint"),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"POST /upload/**")),Object(l.b)("p",null,"Note the ",Object(l.b)("inlineCode",{parentName:"p"},"**"),", if you use a path like ",Object(l.b)("inlineCode",{parentName:"p"},"/upload/my/path"),", then the ",Object(l.b)("inlineCode",{parentName:"p"},"File")," object will have a directory value of ",Object(l.b)("inlineCode",{parentName:"p"},"/my/path"),". "),Object(l.b)("h2",{id:"download-endpoint"},"Download endpoint"),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"GET /file/<path>.ext")),Object(l.b)("p",null,"To download a file uploaded to the platform, the above URL pattern should be used."),Object(l.b)("p",null,"The ",Object(l.b)("inlineCode",{parentName:"p"},"<path>")," is by default the ",Object(l.b)("inlineCode",{parentName:"p"},"ID")," of the ",Object(l.b)("inlineCode",{parentName:"p"},"File")," object. The ",Object(l.b)("inlineCode",{parentName:"p"},".ext")," is the original extension of the file e.g. ",Object(l.b)("inlineCode",{parentName:"p"},".txt"),"."),Object(l.b)("h2",{id:"curl-upload-example"},"curl upload example"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"auth='<hypi-auth-token>'\ncurl -v https://api.hypi.app/upload/ -H \"Accept: application/json\" -H \"Authorization: $auth\" -H 'hypi-domain: <instance-domain>' -F 0=@/path/to/file.txt\n")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"The response of the upload is JSON"),Object(l.b)("li",{parentName:"ul"},"The ",Object(l.b)("inlineCode",{parentName:"li"},"Authorization")," header is required"),Object(l.b)("li",{parentName:"ul"},"The ",Object(l.b)("inlineCode",{parentName:"li"},"hypi-domain")," header is required (like other API requests)")),Object(l.b)("h2",{id:"curl-download-example"},"curl download example"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},'curl -v https://api.hypi.app/file/<id>.ext -H "Authorization: $auth"\n')),Object(l.b)("p",null,"In this example, we provide an authorisation token. This is because files are private to the account which created it by default. To give access to other users or allow anonymous download a permission must be created with appropriate policies."),Object(l.b)("p",null,"For example, to give the anonymous users access (no token required), use an ",Object(l.b)("inlineCode",{parentName:"p"},"AccountPolicy")," to grant the ",Object(l.b)("inlineCode",{parentName:"p"},"anonymous")," user account read access."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-java"},'mutation {\n  upsert(\n    values: {\n      Permission: [\n        {\n          name: "Grant access to anonymous user"\n          decisionStrategy: Unanimous\n          type: "File"\n          resource: "<file-id>"\n          scopes: ["*"]\n          operationType: Query\n          operations: ["find"]\n          #includeAllAccounts: true, //wildcard so all accounts can access\n          policies: [\n            {\n              hypi: { impl: "AccountPolicy" }\n              name: "Grant user anonymous access to my file"\n              logic: Positive\n              accounts: [{ hypi: { id: "anonymous" } }]\n            }\n          ]\n        }\n      ]\n    }\n  ) {\n    id\n  }\n}\n')),Object(l.b)("p",null,"In this example we explicitly give anonymous users access to the file uploaded. This could also have been done by giving access to_all_accounts in the app instance by setting ",Object(l.b)("inlineCode",{parentName:"p"},"includeAllAccounts")," to true."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"curl -v https://api.hypi.app/file/<id>.ext\n")),Object(l.b)("p",null,"Due to the permission above, the curl request can now be made without any authorisation headers."))}c.isMDXComponent=!0},159:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),c=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},s=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,b=p(e,["components","mdxType","originalType","parentName"]),d=c(n),s=a,m=d["".concat(i,".").concat(s)]||d[s]||u[s]||l;return n?r.a.createElement(m,o(o({ref:t},b),{},{components:n})):r.a.createElement(m,o({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,i=new Array(l);i[0]=s;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var b=2;b<l;b++)i[b]=n[b];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}s.displayName="MDXCreateElement"}}]);